# ============================================
# User-Friendly tmux Configuration
# Press ctrl+b to see the interactive menu
# ============================================

# --- Basic Settings ---
set -g default-terminal "screen-256color"
set -g history-limit 50000
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g display-time 2000
set -g escape-time 0

# --- Status Bar ---
set -g status-style 'bg=#333333 fg=#ffffff'
set -g status-left '#[bg=#5555ff,fg=#ffffff,bold] #S #[default] '
set -g status-left-length 30
set -g status-right '#[fg=#888888] %Y-%m-%d #[fg=#ffffff,bold]%H:%M '
set -g status-right-length 50
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[bg=#5555ff,fg=#ffffff,bold] #I:#W '

# --- Pane Borders ---
set -g pane-border-style 'fg=#555555'
set -g pane-active-border-style 'fg=#5555ff,bold'
set -g pane-border-lines heavy

# --- Active Pane Indicator ---
# Inactive panes get a subtle navy tint + muted text so the focused pane stands out.
# To adjust: raise bg hex values for less dimming, lower for more dimming.
set -g window-style 'fg=#888899,bg=#2b2b3d'
# Active pane uses your terminal's native background color (no tint).
set -g window-active-style 'bg=terminal'

# --- Blinking Cursor ---
set -g cursor-style blinking-block

# --- Main Menu (shows on prefix key) ---
bind-key -T prefix ? display-menu -T "#[align=centre]tmux Help Menu" -x C -y C \
    "" \
    "-#[align=centre,bold]━━━ Windows ━━━" "" "" \
    "New Window            (c)" "new-window" \
    "Next Window           (n)" "next-window" \
    "Previous Window       (p)" "previous-window" \
    "List Windows          (w)" "choose-tree -Zw" \
    "Rename Window         (,)" "command-prompt -I '#W' 'rename-window \"%%\"'" \
    "Kill Window           (&)" "confirm-before -p 'Kill window? (y/n)' kill-window" \
    "" \
    "-#[align=centre,bold]━━━ Panes ━━━" "" "" \
    "Split Horizontal      (\")" "split-window -v -c '#{pane_current_path}'" \
    "Split Vertical        (%)" "split-window -h -c '#{pane_current_path}'" \
    "Navigate Panes      (arrows)" "display-message 'Use arrow keys after prefix'" \
    "Zoom Pane             (z)" "resize-pane -Z" \
    "Kill Pane             (x)" "confirm-before -p 'Kill pane? (y/n)' kill-pane" \
    "Swap with Previous    ({)" "swap-pane -U" \
    "Swap with Next        (})" "swap-pane -D" \
    "" \
    "-#[align=centre,bold]━━━ Sessions ━━━" "" "" \
    "New Session" "command-prompt -p 'Session name:' 'new-session -s \"%%\"'" \
    "List Sessions         (s)" "choose-tree -Zs" \
    "Rename Session        ($)" "command-prompt -I '#S' 'rename-session \"%%\"'" \
    "Detach                (d)" "detach-client" \
    "" \
    "-#[align=centre,bold]━━━ Other ━━━" "" "" \
    "Copy Mode             ([)" "copy-mode" \
    "Show Clock            (t)" "clock-mode" \
    "Reload Config         (r)" "source-file ~/.tmux.conf; display-message 'Config reloaded!'" \
    "Command Prompt        (:)" "command-prompt"

# --- Quick Actions Menu (prefix + space) ---
bind-key Space display-menu -T "#[align=centre]Quick Actions" -x C -y C \
    "Split Below" "split-window -v -c '#{pane_current_path}'" \
    "Split Right" "split-window -h -c '#{pane_current_path}'" \
    "" \
    "New Window" "new-window -c '#{pane_current_path}'" \
    "Kill Pane" "confirm-before -p 'Kill pane? (y/n)' kill-pane" \
    "" \
    "Zoom Toggle" "resize-pane -Z" \
    "Sync Panes Toggle" "setw synchronize-panes"

# --- Intuitive Split Bindings ---
bind-key | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"

# --- Easy Pane Navigation (prefix + h/j/k/l) ---
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# --- Pane Resizing (prefix + H/J/K/L) ---
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# --- Reload Config ---
bind-key r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# --- Copy Mode (vi style) ---
setw -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# --- Don't exit copy mode on mouse drag end ---
unbind-key -T copy-mode-vi MouseDragEnd1Pane

# --- Plugins (via TPM) ---
# Install plugins:  prefix + I   (capital I)
# Update plugins:   prefix + U
# Uninstall:        prefix + alt + u
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'alexwforsythe/tmux-which-key'    # Interactive keybinding cheatsheet
set -g @plugin 'tmux-plugins/tmux-resurrect'      # Save/restore sessions across restarts (prefix + Ctrl-s / Ctrl-r)
set -g @plugin 'tmux-plugins/tmux-continuum'       # Auto-saves sessions in the background

# --- Session Persistence (resurrect + continuum) ---
# Sessions auto-save every 15 min and auto-restore when tmux starts.
# Manual save: prefix + Ctrl-s   Manual restore: prefix + Ctrl-r
# Saved session data lives in ~/.tmux/resurrect/
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
set -g @resurrect-capture-pane-contents 'on'

# Keep this line at the very bottom — TPM needs it to load plugins.
run '~/.tmux/plugins/tpm/tpm'
